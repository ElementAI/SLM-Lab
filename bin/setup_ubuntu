#!/bin/bash --login
# This script sets up SLM Lab for Linux Ubuntu

# Fail on the first error; killable by SIGINT
set -e
trap "exit" INT

echo "--- Installing system dependencies ---"
apt-get update && \
  apt-get install -y build-essential \
  curl nano git wget zip libstdc++6 \
  python3-dev zlib1g-dev libjpeg-dev cmake swig python-pyglet python3-opengl libboost-all-dev libsdl2-dev libosmesa6-dev patchelf ffmpeg xvfb && \
  rm -rf /var/lib/apt/lists/*

echo "--- Installing Python Dependencies ---"
source "${HOME}"/.mvenv/mvenv.sh
mve activate SLM-Lab
if [ -z "${VIRTUAL_ENV}" ] >/dev/null; then
  echo "Create a venv and try again"
  exit 1
else
  pip install -U pip wheel
  pip install -r requirements.txt
  echo
  echo "Python dependencies successfully installed."
  echo
  echo "Install Orca from https://github.com/plotly/orca/releases"
  echo "For Ubuntu using the AppImage shows promising"
  wget https://github.com/plotly/orca/releases/download/v1.3.1/orca-1.3.1.AppImage
  echo "Rename to 'orca' and give it executable permissions."
  sudo mv orca-1.3.1.AppImage ~/bin/orca
  sudo chmod +x ~/bin/orca
fi
